CLASS Node

	# Basic fields
    FIELD line: INTEGER
    FIELD level: INTEGER
    FIELD name: STRING		
    FIELD namespace: STRING
    FIELD block_text: BOOLEAN
    
    # Derived fields
    FIELD normalized_name: STRING
    FIELD qualified_name: STRING

	# Childs and vlues
    FIELD value: STRING
    FIELD text_lines: STRING[]
    FIELD children: Node[]
    
    # Optional Frozen flag
    FIELD is_frozen: BOOLEAN = false

    CONSTRUCTOR (line, level, name, namespace, block_text, value)
        line 		= line
        level 		= level
        name 		= compactSpaces(name)
        namespace 	= lowerCase(namespace)
        block_text	= block_text
		value 		= trimToNotNull(value)

        normalized_name	= normalize(name)
        
        IF namespace.isEmpty()
            qualified_name = normalized_name
        ELSE
            qualified_name = namespace + ":" + normalized_name
        END IF

		# Basic checks
		IF NOT validNamespaceFormat(namespace)
			ERROR(line, "Not empty value with Block Text")
		END IF

        IF NOT value.isEmpty() AND block_text
            ERROR(line, "Not empty value with Block Text")
        END IF

        IF normalized_name.isEmpty()
            ERROR(line, "Empty normalized name")
        END IF
    END CONSTRUCTOR

	# Optional method
    PROCEDURE freeze()
        IF is_frozen
            RETURN
        END IF

        FOREACH node IN children
            node.freeze()
        END FOREACH

        children 	= freeze(children)
        text_lines	= freeze(text_lines)

        is_frozen = true
    END PROCEDURE

END CLASS
